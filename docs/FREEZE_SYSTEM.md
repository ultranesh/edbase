# Система заморозки студентов

## Как работает

### Заморозка студента

1. Куратор нажимает "Заморозить" у активного студента
2. Система запрашивает количество дней заморозки
3. Проверяется наличие достаточного количества дней в `freezeDays`
4. Рассчитывается дата окончания: `сегодня + количество дней`
5. Сохраняется в поле `freezeEndDate`
6. **`studyEndDate` продлевается на количество дней заморозки**
7. Статус меняется на `FROZEN`

**Важно**:
- Дни из `freezeDays` НЕ вычитаются сразу!
- Срок обучения (`studyEndDate`) автоматически продлевается

### Отображение

В таблице студентов показывается:
- Для статуса "На заморозке": синий badge + "до [дата окончания заморозки]"
- Для статуса "Активно": зеленый badge + "до [дата окончания обучения]"

### Автоматическая обработка (ежедневно)

Endpoint: `POST /api/cron/process-freeze`

**Должен вызываться каждый день** (например, в 00:00) через:
- Vercel Cron Jobs
- GitHub Actions
- Внешний сервис (cron-job.org)

Что делает:
1. Находит всех студентов со статусом `FROZEN`
2. Для каждого:
   - Если `freezeEndDate` <= сегодня → разморозить (статус → ACTIVE, очистить freezeEndDate)
   - Если еще заморожен:
     - Вычесть 1 день из `freezeDays`
     - **Продлить `studyEndDate` на 1 день**
3. Таким образом дни вычитаются постепенно, и срок обучения продлевается каждый день

### Разморозка вручную

Куратор может разморозить студента досрочно:
1. Нажать "Разморозить"
2. Статус → ACTIVE
3. freezeEndDate → null
4. **`studyEndDate` корректируется назад на неиспользованные дни заморозки**
5. freezeDays остается как есть (не возвращаются дни)

## Редактирование данных студента

### Права доступа:

**ADMIN (Администратор)**:
- Может редактировать личную информацию (кроме email)
- Может редактировать учебную информацию (класс, школа, предметы и т.д.)
- Может редактировать данные подписки (месяцы, дни заморозки)
- Может редактировать суммы оплаты
- **НЕ может** редактировать email
- **НЕ может** редактировать даты (траншей, начала/конца обучения)

**SUPERADMIN (Суперадминистратор)**:
- Полный доступ ко всем полям
- Может редактировать email
- Может редактировать все даты (траншей, начала/конца обучения)
- Может редактировать абсолютно любые данные пользователя

## Настройка Cron Job

### Vercel (рекомендуется)

Создать файл `vercel.json`:

\`\`\`json
{
  "crons": [
    {
      "path": "/api/cron/process-freeze",
      "schedule": "0 0 * * *"
    }
  ]
}
\`\`\`

### GitHub Actions

\`\`\`yaml
name: Daily Freeze Processing
on:
  schedule:
    - cron: '0 0 * * *'
jobs:
  process:
    runs-on: ubuntu-latest
    steps:
      - name: Call API
        run: |
          curl -X POST https://ertis-classroom.vercel.app/api/cron/process-freeze
\`\`\`

## Уведомления (TODO)

В будущем добавить:
- Уведомление за 1 день до окончания заморозки
- Уведомление при автоматической разморозке
- Email/SMS уведомления родителям
